{
   "graphTooltip": 1,
   "panels": [
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "description": "Traffic",
         "gridPos": {
            "h": 16,
            "w": 24,
            "y": 0
         },
         "id": 1,
         "interval": "5s",
         "options": {
            "nodes": {
               "mainStatUnit": "reqps"
            }
         },
         "pluginVersion": "v11.0.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "label_join(count_values without() (\"mainstat\", round((sum by (id) (label_join(rate(istio_requests_total{reporter=\"destination\"}[$__rate_interval]), \"id\", \"\", \"destination_canonical_service\")) + sum by (id) (label_join(rate(istio_requests_total{reporter=\"source\"}[$__rate_interval]), \"id\", \"\", \"source_canonical_service\")))\nor\n(sum by (id) (label_join(rate(istio_requests_total{reporter=\"destination\"}[$__rate_interval]), \"id\", \"\", \"destination_canonical_service\")) unless sum by (id) (label_join(rate(istio_requests_total{reporter=\"source\"}[$__rate_interval]), \"id\", \"\", \"source_canonical_service\")))\nor\n(sum by (id) (label_join(rate(istio_requests_total{reporter=\"source\"}[$__rate_interval]), \"id\", \"\", \"source_canonical_service\")) unless sum by (id) (label_join(rate(istio_requests_total{reporter=\"destination\"}[$__rate_interval]), \"id\", \"\", \"destination_canonical_service\")))\n, 0.01)), \"title\", \"\", \"id\")",
               "format": "table",
               "instant": true,
               "refId": "nodes"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "count_values without() (\"mainstat\", label_join(label_join(round((label_join(sum by (source_canonical_service,destination_canonical_service) (rate(istio_requests_total{reporter=\"destination\"}[$__rate_interval])), \"id\", \"~rev~\", \"source_canonical_service\",\"destination_canonical_service\") + label_join(sum by (source_canonical_service,destination_canonical_service) (rate(istio_requests_total{reporter=\"source\"}[$__rate_interval])), \"id\", \"~\", \"source_canonical_service\",\"destination_canonical_service\"))\nor\n(label_join(sum by (source_canonical_service,destination_canonical_service) (rate(istio_requests_total{reporter=\"destination\"}[$__rate_interval])), \"id\", \"~rev~\", \"source_canonical_service\",\"destination_canonical_service\") unless label_join(sum by (source_canonical_service,destination_canonical_service) (rate(istio_requests_total{reporter=\"source\"}[$__rate_interval])), \"id\", \"~\", \"source_canonical_service\",\"destination_canonical_service\"))\nor\n(label_join(sum by (source_canonical_service,destination_canonical_service) (rate(istio_requests_total{reporter=\"source\"}[$__rate_interval])), \"id\", \"~\", \"source_canonical_service\",\"destination_canonical_service\") unless label_join(sum by (source_canonical_service,destination_canonical_service) (rate(istio_requests_total{reporter=\"destination\"}[$__rate_interval])), \"id\", \"~rev~\", \"source_canonical_service\",\"destination_canonical_service\"))\n, 0.01), \"source\", \"\", \"source_canonical_service\"), \"target\", \"\", \"destination_canonical_service\"))",
               "format": "table",
               "instant": true,
               "refId": "edges"
            }
         ],
         "title": "Traffic",
         "type": "nodeGraph"
      }
   ],
   "refresh": "15s",
   "schemaVersion": 39,
   "templating": {
      "list": [
         {
            "name": "datasource",
            "query": "prometheus",
            "type": "datasource"
         }
      ]
   },
   "time": {
      "from": "now-30m",
      "to": "now"
   },
   "timezone": "utc",
   "title": "Istio Node Graph",
   "uid": "bee3c4b413fc727c3f448635ceca3606"
}
